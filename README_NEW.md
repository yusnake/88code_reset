# 88code è®¢é˜…é‡ç½®å·¥å…· - é‡æ„ç‰ˆæœ¬

## ğŸ‰ é‡æ„å®Œæˆ

æœ¬é¡¹ç›®å·²å®Œæˆä»ç¯å¢ƒå˜é‡é…ç½®åˆ° Web ç•Œé¢ç®¡ç†çš„å®Œå…¨é‡æ„ã€‚

## âœ¨ æ–°åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒæ”¹è¿›

1. **Web ç®¡ç†ç•Œé¢** - æ— éœ€é‡å¯ Docker å³å¯ç®¡ç† Token å’Œé…ç½®
2. **é›¶è½®è¯¢è®¾è®¡** - å®Œå…¨ç§»é™¤ 5 åˆ†é’Ÿè®¢é˜…æ£€æŸ¥ï¼Œåªåœ¨é‡ç½®æ—¶è¯·æ±‚ API
3. **è‡ªåŠ¨è·å–è®¢é˜…** - æ·»åŠ  Token æ—¶è‡ªåŠ¨è·å–å¹¶å±•ç¤ºè®¢é˜…è¯¦æƒ…
4. **ç‹¬ç«‹é˜ˆå€¼é…ç½®** - ç¬¬ä¸€æ¬¡é‡ç½® 70%ï¼Œç¬¬äºŒæ¬¡é‡ç½® 100%ï¼Œå‡å¯è°ƒæ•´
5. **åŒé‡å¯ç”¨å¼€å…³** - ç¬¬ä¸€æ¬¡å’Œç¬¬äºŒæ¬¡é‡ç½®éƒ½å¯ç‹¬ç«‹å¯ç”¨/ç¦ç”¨
6. **é…ç½®çƒ­é‡è½½** - æ›´æ–°é…ç½®ç«‹å³ç”Ÿæ•ˆï¼Œæ— éœ€é‡å¯
7. **æ‰‹åŠ¨é‡ç½®åŠŸèƒ½** - æ”¯æŒé€šè¿‡ Web ç•Œé¢æ‰‹åŠ¨è§¦å‘é‡ç½®

## ğŸ“¦ å®‰è£…å’Œç¼–è¯‘

### 1. ä¸‹è½½ä¾èµ–

```bash
cd D:\Cursor-test\88code_reset
go mod tidy
```

### 2. æœ¬åœ°ç¼–è¯‘

```bash
go build -o reset.exe ./cmd/reset
```

### 3. Docker æ„å»º

```bash
docker-compose build
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹å¼ä¸€ï¼šDocker Composeï¼ˆæ¨èï¼‰

1. **è®¾ç½®ç®¡ç†å‘˜å¯†ç **ï¼ˆå¯é€‰ï¼Œé»˜è®¤ä¸º `admin123`ï¼‰

åˆ›å»ºæˆ–ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š

```env
WEB_ADMIN_TOKEN=your_secure_password_here
```

2. **å¯åŠ¨æœåŠ¡**

```bash
# å¯åŠ¨ Web ç®¡ç†æ¨¡å¼ï¼ˆæ–°ç‰ˆï¼‰
docker-compose up -d reset-web

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f reset-web
```

3. **è®¿é—®ç®¡ç†ç•Œé¢**

æ‰“å¼€æµè§ˆå™¨è®¿é—®: `http://localhost:8966`

è¾“å…¥ç®¡ç†å‘˜ Token: `your_secure_password_here`ï¼ˆæˆ–é»˜è®¤çš„ `admin123`ï¼‰

### æ–¹å¼äºŒï¼šç›´æ¥è¿è¡Œ

```bash
# Windows
set WEB_ADMIN_TOKEN=your_password
.\reset.exe -mode=web

# Linux/Mac
export WEB_ADMIN_TOKEN=your_password
./reset -mode=web
```

## ğŸ¯ ä½¿ç”¨æµç¨‹

### 1. æ·»åŠ  Token

åœ¨ Web ç•Œé¢ä¸­ï¼š
1. ç‚¹å‡» "æ·»åŠ æ–° Token"
2. è¾“å…¥ Token åç§°ï¼ˆä¾‹å¦‚ï¼šè´¦å·Aï¼‰
3. è¾“å…¥ API Keyï¼ˆsk-ant-xxxxxï¼‰
4. ç‚¹å‡»"æ·»åŠ "

ç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š
- éªŒè¯ API Key æœ‰æ•ˆæ€§
- è·å–å…³è”çš„è®¢é˜…ä¿¡æ¯
- æ˜¾ç¤ºç”¨æˆ·åã€é‚®ç®±ã€ç§¯åˆ†ç­‰è¯¦æƒ…

### 2. é…ç½®é‡ç½®è§„åˆ™

åœ¨"é‡ç½®é…ç½®"åŒºåŸŸï¼š
- **ç¬¬ä¸€æ¬¡é‡ç½®**ï¼šè®¾ç½®æ˜¯å¦å¯ç”¨ã€é˜ˆå€¼ï¼ˆé»˜è®¤ 70%ï¼‰
- **ç¬¬äºŒæ¬¡é‡ç½®**ï¼šè®¾ç½®æ˜¯å¦å¯ç”¨ã€é˜ˆå€¼ï¼ˆé»˜è®¤ 100%ï¼‰
- ç‚¹å‡»"ä¿å­˜é…ç½®"ç«‹å³ç”Ÿæ•ˆ

### 3. è‡ªåŠ¨é‡ç½®

ç³»ç»Ÿä¼šæ ¹æ®é…ç½®åœ¨æŒ‡å®šæ—¶é—´è‡ªåŠ¨é‡ç½®ï¼š
- ç¬¬ä¸€æ¬¡ï¼š18:50ï¼ˆå¦‚æœå¯ç”¨ä¸”ç§¯åˆ† < 70%ï¼‰
- ç¬¬äºŒæ¬¡ï¼š23:55ï¼ˆå¦‚æœå¯ç”¨ä¸”ç§¯åˆ† < 100%ï¼‰

### 4. æ‰‹åŠ¨é‡ç½®

éšæ—¶å¯ä»¥ï¼š
- ç‚¹å‡»å•ä¸ª Token çš„"é‡ç½®"æŒ‰é’®
- ç‚¹å‡»å…¨å±€"æ‰‹åŠ¨è§¦å‘é‡ç½®"æŒ‰é’®

## ğŸ“‹ API æ¥å£æ–‡æ¡£

### è®¤è¯

æ‰€æœ‰ API è¯·æ±‚éœ€è¦åœ¨ Header ä¸­æ·»åŠ ï¼š

```
Authorization: Bearer <WEB_ADMIN_TOKEN>
```

### ä¸»è¦ç«¯ç‚¹

#### è·å–ç³»ç»ŸçŠ¶æ€

```bash
GET /api/status
```

è¿”å›ï¼šå½“å‰æ—¶é—´ã€ä¸‹æ¬¡é‡ç½®æ—¶é—´ã€Token æ•°é‡ç­‰

#### è·å– Token åˆ—è¡¨

```bash
GET /api/tokens
```

#### æ·»åŠ  Token

```bash
POST /api/tokens
Content-Type: application/json

{
  "api_key": "sk-ant-xxxxx",
  "name": "è´¦å·A"
}
```

#### åˆ·æ–°è®¢é˜…ä¿¡æ¯

```bash
PUT /api/tokens/{token_id}/refresh
```

#### æ‰‹åŠ¨é‡ç½®

```bash
PUT /api/tokens/{token_id}/reset
Content-Type: application/json

{
  "reset_type": "second"
}
```

#### æ‰¹é‡é‡ç½®

```bash
POST /api/reset/trigger
Content-Type: application/json

{
  "reset_type": "first"
}
```

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

| å˜é‡å | è¯´æ˜ | é»˜è®¤å€¼ |
|--------|------|--------|
| `WEB_ADMIN_TOKEN` | Web ç®¡ç†å‘˜å¯†ç  | `admin123` |
| `WEB_PORT` | Web æœåŠ¡å™¨ç«¯å£ | `8966` |

### æ•°æ®æ–‡ä»¶

æ‰€æœ‰æ•°æ®ä¿å­˜åœ¨ `./data` ç›®å½•ï¼š

- `tokens.json` - Token åˆ—è¡¨å’Œè®¢é˜…ä¿¡æ¯
- `config.json` - åŠ¨æ€é…ç½®ï¼ˆé˜ˆå€¼ã€å¯ç”¨å¼€å…³ç­‰ï¼‰
- `status.json` - æ‰§è¡ŒçŠ¶æ€è®°å½•
- `account.json` - è´¦å·ä¿¡æ¯ï¼ˆä¼ ç»Ÿæ¨¡å¼ï¼‰

### æ—¥å¿—æ–‡ä»¶

æ—¥å¿—ä¿å­˜åœ¨ `./logs` ç›®å½•ï¼š

- `reset.log` - ä¸»æ—¥å¿—æ–‡ä»¶
- æŒ‰å¤©åˆ†å‰²ï¼Œè‡ªåŠ¨æ¸…ç†

## ğŸ”„ ä»æ—§ç‰ˆæœ¬è¿ç§»

### å…¼å®¹æ€§

æ–°ç‰ˆæœ¬å®Œå…¨å‘åå…¼å®¹ï¼Œä¿ç•™äº†åŸæœ‰çš„ `run`ã€`test`ã€`list` æ¨¡å¼ã€‚

### è¿ç§»æ­¥éª¤

1. **ç»§ç»­ä½¿ç”¨æ—§æ¨¡å¼**ï¼ˆå¯é€‰ï¼‰

```bash
# ä½¿ç”¨ä¼ ç»Ÿçš„ç¯å¢ƒå˜é‡æ–¹å¼
docker-compose --profile legacy up -d reset-scheduler
```

2. **è¿ç§»åˆ°æ–°æ¨¡å¼**ï¼ˆæ¨èï¼‰

```bash
# åœæ­¢æ—§æœåŠ¡
docker-compose down

# å¯åŠ¨æ–°æœåŠ¡
docker-compose up -d reset-web

# åœ¨ Web ç•Œé¢æ·»åŠ åŸæ¥ç¯å¢ƒå˜é‡ä¸­çš„ API Key
```

## ğŸ› ï¸ è¿è¡Œæ¨¡å¼

### Web æ¨¡å¼ï¼ˆæ–°ç‰ˆï¼Œæ¨èï¼‰

```bash
./reset -mode=web
```

- å¯åŠ¨ Web ç®¡ç†ç•Œé¢
- ä½¿ç”¨ Token ç®¡ç†å™¨
- é…ç½®çƒ­é‡è½½
- ç«¯å£ï¼š8966

### Run æ¨¡å¼ï¼ˆä¼ ç»Ÿï¼‰

```bash
./reset -mode=run -apikey=sk-ant-xxxxx
```

- ä½¿ç”¨ç¯å¢ƒå˜é‡é…ç½®
- ä¼ ç»Ÿè°ƒåº¦å™¨
- ä¸æ—§ç‰ˆæœ¬å®Œå…¨å…¼å®¹

### Test æ¨¡å¼

```bash
./reset -mode=test -apikey=sk-ant-xxxxx
```

- æµ‹è¯• API è¿æ¥
- æ˜¾ç¤ºè®¢é˜…ä¿¡æ¯
- ä¸æ‰§è¡Œé‡ç½®

### List æ¨¡å¼

```bash
./reset -mode=list
```

- åˆ—å‡ºå†å²è´¦å·ä¿¡æ¯

## ğŸ“Š é‡æ„ç»Ÿè®¡

### ä»£ç å˜æ›´

- **æ–°å¢æ–‡ä»¶**: 9 ä¸ª
  - `internal/config/dynamic.go` (200 è¡Œ)
  - `internal/token/storage.go` (220 è¡Œ)
  - `internal/token/manager.go` (350 è¡Œ)
  - `internal/web/server.go` (200 è¡Œ)
  - `internal/web/handlers.go` (270 è¡Œ)
  - `internal/web/middleware.go` (80 è¡Œ)
  - `internal/web/static/index.html` (650 è¡Œ)

- **ä¿®æ”¹æ–‡ä»¶**: 6 ä¸ª
  - `internal/models/models.go` (+100 è¡Œ)
  - `internal/reset/reset.go` (ä¿®æ”¹ 30 è¡Œ)
  - `internal/scheduler/*.go` (åˆ é™¤ 100+ è¡Œ)
  - `cmd/reset/main.go` (å®Œå…¨é‡æ„ï¼Œ+250 è¡Œ)
  - `go.mod` (+1 ä¾èµ–)
  - `Dockerfile` (+2 è¡Œ)
  - `docker-compose.yml` (é‡æ„)

- **æ€»è®¡**: æ–°å¢ ~2000 è¡Œï¼Œåˆ é™¤ ~100 è¡Œ

### åŠŸèƒ½å¯¹æ¯”

| åŠŸèƒ½ | æ—§ç‰ˆæœ¬ | æ–°ç‰ˆæœ¬ |
|------|--------|--------|
| API è½®è¯¢é¢‘ç‡ | æ¯ 5 åˆ†é’Ÿ | 0ï¼ˆä»…é‡ç½®æ—¶ï¼‰ |
| Token ç®¡ç†æ–¹å¼ | ç¯å¢ƒå˜é‡ | Web ç•Œé¢ |
| é…ç½®æ›´æ–° | éœ€è¦é‡å¯ | å®æ—¶ç”Ÿæ•ˆ |
| è®¢é˜…ä¿¡æ¯è·å– | å®šæ—¶è½®è¯¢ | æ·»åŠ æ—¶ + æ‰‹åŠ¨åˆ·æ–° |
| ç¬¬ä¸€æ¬¡é‡ç½® | å¯å¯ç”¨/ç¦ç”¨ | âœ“ |
| ç¬¬äºŒæ¬¡é‡ç½® | å¼ºåˆ¶å¯ç”¨ | å¯å¯ç”¨/ç¦ç”¨ |
| ç¬¬ä¸€æ¬¡é˜ˆå€¼ | 83% | 70%ï¼ˆå¯è°ƒï¼‰ |
| ç¬¬äºŒæ¬¡é˜ˆå€¼ | 100%ï¼ˆå›ºå®šï¼‰ | 100%ï¼ˆå¯è°ƒï¼‰ |
| æ‰‹åŠ¨é‡ç½® | âœ— | âœ“ |
| ç®¡ç†ç•Œé¢ | âœ— | âœ“ |

## ğŸ”’ å®‰å…¨å»ºè®®

1. **ä¿®æ”¹é»˜è®¤å¯†ç **

```env
WEB_ADMIN_TOKEN=use_a_strong_password_here
```

2. **ä»…æœ¬åœ°è®¿é—®**

å¦‚æœåªåœ¨æœ¬åœ°ä½¿ç”¨ï¼Œå°† docker-compose.yml ä¸­çš„ç«¯å£æ”¹ä¸ºï¼š

```yaml
ports:
  - "127.0.0.1:8966:8966"
```

3. **ä½¿ç”¨åå‘ä»£ç†**

ç”Ÿäº§ç¯å¢ƒå»ºè®®é€šè¿‡ Nginx ç­‰åå‘ä»£ç†è®¿é—®ï¼Œå¹¶å¯ç”¨ HTTPSã€‚

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **æ•°æ®æŒä¹…åŒ–**: ç¡®ä¿ `./data` ç›®å½•å·²æŒ‚è½½åˆ° Docker å®¹å™¨
2. **æ—¶åŒºè®¾ç½®**: é»˜è®¤ä½¿ç”¨ `Asia/Shanghai`ï¼Œå¯åœ¨é…ç½®ä¸­ä¿®æ”¹
3. **æ—¥å¿—ç®¡ç†**: æ—¥å¿—æ–‡ä»¶ä¼šè‡ªåŠ¨æŒ‰å¤©åˆ†å‰²
4. **å¹¶å‘æ§åˆ¶**: ä½¿ç”¨æ–‡ä»¶é”é˜²æ­¢é‡å¤æ‰§è¡Œ
5. **PAYGO ä¿æŠ¤**: å¤šå±‚æ£€æŸ¥é˜²æ­¢è¯¯é‡ç½®æŒ‰é‡ä»˜è´¹è®¢é˜…

## ğŸ› æ•…éšœæ’æŸ¥

### Web ç•Œé¢æ— æ³•è®¿é—®

1. æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
2. æŸ¥çœ‹æ—¥å¿—ï¼š`docker-compose logs reset-web`
3. ç¡®è®¤é˜²ç«å¢™è®¾ç½®

### Token æ·»åŠ å¤±è´¥

1. æ£€æŸ¥ API Key æ ¼å¼æ˜¯å¦æ­£ç¡®
2. ç¡®è®¤ç½‘ç»œå¯ä»¥è®¿é—® `www.88code.org`
3. æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯

### é‡ç½®æœªæ‰§è¡Œ

1. æ£€æŸ¥ Token æ˜¯å¦å¯ç”¨
2. ç¡®è®¤é‡ç½®é…ç½®å·²ä¿å­˜
3. æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€ä¸­çš„"ä¸‹æ¬¡é‡ç½®æ—¶é—´"
4. æ£€æŸ¥æ—¥å¿—æ–‡ä»¶

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ‘¨â€ğŸ’» ä½œè€…

88code Reset Tool Team

## ğŸ™ è‡´è°¢

æ„Ÿè°¢æ‰€æœ‰è´¡çŒ®è€…å’Œç”¨æˆ·çš„æ”¯æŒï¼
